<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Artificial Neural Network library implemented in Python">
        <meta name="viewport" content="width=device-width">
        <title>Neural Network Surgery &mdash; NeuPy</title>
            <link rel="stylesheet" href="../_static/normalize.css" type="text/css">
            <link rel="stylesheet" href="../_static/sphinx.css" type="text/css">
            <link rel="stylesheet" href="../_static/main.css" type="text/css">
            <link rel="stylesheet" href="../_static/flat.css" type="text/css">
            <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="../_static/font-awesome.min.css" type="text/css">
        <link rel="shortcut icon" href="../_static/favicon.ico" /><!-- Load modernizr and JQuery -->
        <script src="../_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="../_static/plugins.js"></script>
        <script src="../_static/main.js"></script>
        <link rel="next" title="Plots" href="plots.html" /><link rel="prev" title="Storage" href="storage.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../_static/underscore.js"></script><script type="text/javascript" src="../_static/doctools.js"></script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/javascript" src="../_static/disqus.js"></script><script type="text/javascript" src="../_static/js/google_analytics.js"></script><script type="text/javascript" src="../_static/js/script.js"></script><script type="text/javascript" src="../_static/js/copybutton.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Scroll to content if on small screen
            if (screen.width < 480)
            {
                $(document).scrollTop(document.getElementsByTagName("article")[0].offsetTop - 44);
            }
        });
    </script>
<style media="screen" type="text/css">
    #fork_me { display: none; }
    #fork_me img { position: fixed; top: 0; right: 0; border: 0; width: 130px; }
    @media only screen and (min-width: 768px) { #fork_me { display: inline; } }

    .docutils { width: 100%; }
    .docutils td { padding: 10px; }
    .section { word-wrap:break-word; }
    .descname { font-weight: bold; }
    .highlight-python + .figure { margin-top: 20px; }
    .dataframe { text-align: center !important; width: 100%; margin: 10px 0 10px 0; }
    .dataframe td { padding: 5px; }

    .math .gd { color: #000 !important; } /* Generic.Deleted */
    .math .m { color: #000 !important; } /* Literal.Number */
    .math .s { color: #000 !important; } /* Literal.String */
    .math .mf { color: #000 !important; } /* Literal.Number.Float */
    .math .mh { color: #000 !important; } /* Literal.Number.Hex */
    .math .mi { color: #000 !important; } /* Literal.Number.Integer */
    .math .mo { color: #000 !important; } /* Literal.Number.Oct */
    .math .sc { color: #000 !important; } /* Literal.String.Char */
    .math .s2 { color: #000 !important; } /* Literal.String.Double */
    .math .si { color: #000 !important; } /* Literal.String.Interpol */
    .math .sx { color: #000 !important; } /* Literal.String.Other */
    .math .s1 { color: #000 !important; } /* Literal.String.Single */
    .math .ss { color: #000 !important; } /* Literal.String.Symbol */
    .math .il { color: #000 !important; } /* Literal.Number.Integer.Long */
</style></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><header role="banner">
            <hgroup>
              <h1><a href="../pages/home.html">NeuPy</a></h1><h2>Neural Networks in Python</h2></hgroup>
          </header>
      <nav role="navigation">
            <ul><li class="main-nav">
                  <a href="../pages/home.html">Home</a>
                </li>
              <li class="main-nav">
                  <a href="../page1.html">Articles</a>
                </li>
              <li class="main-nav">
                  <a href="../pages/documentation.html">Documentation</a>
                </li>
              <li class="main-nav">
                  <a href="../pages/installation.html">Installation</a>
                </li>
              </ul>
          </nav><div class="main-container" role="main"><div class="main wrapper body clearfix"><article>
    <div class="section" id="neural-network-surgery">
<h1>Neural Network Surgery</h1>
<p>It&#8217;s very easy to define relations between layers in NeuPy. Also NeuPy&#8217;s syntax makes it easy to read and understand your network&#8217;s strucutre. But any method should have its pros and cons. The main disadvantage of this approach is that it&#8217;s a bit complecated to use a part of the network when you define full network. To solve this issue in NeuPy exists module named as a surgery. The idea is simple. You still can define your networks using very simple syntax and then cut pieces from them and connect these pieces together in the new networks.</p>
<div class="section" id="cutting-layers-from-the-network">
<h2>Cutting layers from the network</h2>
<p>Cut is a first feature of a surgery module. You can cut network in a few different ways. To make it simple to understand I&#8217;m going to cinsider a simple pretraining autoencoder problem. Let&#8217;s define the autoencoder network.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">neupy</span> <span class="kn">import</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">layers</span>

<span class="n">autoencoder</span> <span class="o">=</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="mi">784</span><span class="p">),</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
        <span class="n">layers</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="mi">784</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">momentum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">error</span><span class="o">=</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">load_mnist</span><span class="p">()</span>
<span class="n">autoencoder</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see we define a very simple autoencoder that trains over 20 epochs. Trained networks contain two pieces that usually known as encoder and decoder networks. In case of pretraining we are interested in encoding layer. Let&#8217;s cut this part.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">neupy</span> <span class="kn">import</span> <span class="n">surgery</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">surgery</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">autoencoder</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span>
<span class="go">Input(784) &gt; Sigmoid(100)</span>
</pre></div>
</div>
<p>As you can see this operation is similar to Python&#8217;s slicings. Basically this operation do something like this.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># NOTE: This is a pseudo-code, so it will</span>
<span class="c1"># not work in the NeuPy</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">autoencoder_layers</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>Since we can part of the network that do an encoding procedure we can attach pretrained part to the other network that will manage to do classification.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">classifier</span> <span class="o">=</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span>
    <span class="n">encoder</span> <span class="o">&gt;</span> <span class="n">layers</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">momentum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">error</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>That&#8217;s it, now you have classifier with pretrained layer. Now you can check its final structure.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">classifier</span><span class="o">.</span><span class="n">architecture</span><span class="p">()</span>
<span class="go">-----------------------------------------------</span>
<span class="go">| # | Input shape | Layer Type | Output shape |</span>
<span class="go">-----------------------------------------------</span>
<span class="go">| 1 | 784         | Input      | 784          |</span>
<span class="go">| 2 | 784         | Sigmoid    | 100          |</span>
<span class="go">| 3 | 100         | Softmax    | 10           |</span>
<span class="go">-----------------------------------------------</span>
</pre></div>
</div>
<p>Such a method can be unsutable when you deal with networks that have more than 10 layers. To make simplify these procedure for the bigger networks NeuPy gives an ability to predefine places where you need to cut network into pieces. Surgery module contains class <span class="docutils literal"><span class="pre">CutLine</span></span>. These class defines places where you want to cut network. Let&#8217;s consider another example. Suppose we need to cut all hidden layers from the network. Here is an example on how we can do that with predefined layout.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">neupy</span> <span class="kn">import</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">surgery</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">GradientDescent</span><span class="p">([</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>

    <span class="n">surgery</span><span class="o">.</span><span class="n">CutLine</span><span class="p">(),</span>  <span class="c1"># &lt;- first cut point</span>

    <span class="n">layers</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">layers</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>

    <span class="n">surgery</span><span class="o">.</span><span class="n">CutLine</span><span class="p">(),</span>  <span class="c1"># &lt;- second cut point</span>

    <span class="n">layers</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="p">])</span>
</pre></div>
</div>
<p>In the surgery module there exists another function that can do this procedure. Here is how it works.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cutted_connections</span> <span class="o">=</span> <span class="n">surgery</span><span class="o">.</span><span class="n">cut_along_lines</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">cutted_connections</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Input(5)</span>
<span class="go">Sigmoid(10) &gt; Sigmoid(20) &gt; Sigmoid(30)</span>
<span class="go">Sigmoid(1)</span>
</pre></div>
</div>
<p>It returns a list that contains all of these pieces. Now you can get piece that yu are interested in.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">_</span><span class="p">,</span> <span class="n">hidden_layers</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cutted_connections</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hidden_layers</span>
<span class="go">Sigmoid(10) &gt; Sigmoid(20) &gt; Sigmoid(30)</span>
</pre></div>
</div>
<p>As in the autoencoder case we can use this layers in the other networks</p>
</div>
<div class="section" id="sew-layers-together">
<h2>Sew layers together</h2>
<p>Surgery module not only can break networks into pieces, but it also cut join different pieces together. It&#8217;s known as <strong>sewing</strong>. We can use cutted layers from the previous example.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span>
<span class="go">Input(784) &gt; Sigmoid(100)</span>
<span class="go">&gt;&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hidden_layers</span>
<span class="go">Sigmoid(10) &gt; Sigmoid(20) &gt; Sigmoid(30)</span>
</pre></div>
</div>
<p>Let&#8217;s imagine that we need to join them together. The main problem is that we are not able to combine networks together. The reason is that the <span class="docutils literal"><span class="pre">encoder</span></span> produces 100 dimensional output, while <span class="docutils literal"><span class="pre">hidden_layers</span></span> expects 5 dimensional input. To connect them together we need to define intermidiate layer.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">connected_layers</span> <span class="o">=</span> <span class="n">surgery</span><span class="o">.</span><span class="n">sew_together</span><span class="p">([</span>
<span class="gp">... </span>    <span class="n">encoder</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">layers</span><span class="o">.</span><span class="n">Relu</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">hidden_layers</span>
<span class="gp">... </span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">connected_layers</span>
<span class="go">Input(784) &gt; Sigmoid(100) &gt; Relu(5) &gt; Sigmoid(10) &gt; Sigmoid(20) &gt; Sigmoid(30)</span>
</pre></div>
</div>
</div>
</div>

    <div class="postmeta">
        
        
        
        </div><ul class="related clearfix">
            <li class="left"> &laquo; <a href="storage.html">Storage</a></li>
            <li class="right"><a href="plots.html">Plots</a> &raquo; </li>
        </ul></article><aside class="sidebar"><section><div class="widget">
    <h1>Recent Posts</h1>
    <ul><li>
            <a href="../2015/09/21/password_recovery.html">Password recovery</a>
        </li><li>
            <a href="../2015/09/20/discrete_hopfield_network.html">Discrete Hopfiel Network</a>
        </li><li>
            <a href="../2015/07/04/boston_house_prices_dataset.html">Boston house-prices dataset</a>
        </li><li>
            <a href="../2015/07/04/visualize_backpropagation_algorithms.html">Visualize Algorithms based on the Backpropagation</a>
        </li></ul>
</div>
</section><section><div class="widget">
    <h1>Cheat sheet</h1>
    <ul>
        <li><a href="algorithms.html#algorithms">Algorithms</a></li>
        <li><a href="algorithms.html#layers">Layers</a></li>
        <li><a href="algorithms.html#error-functions">Error functions</a></li>
    </ul>
</div></section><section><div class="widget">
    <h1>Installation</h1>
    <div class="highligh-bash">
        <div class="highlight">
            <pre>pip install neupy</pre>
        </div>
    </div>
    <p>Read more in <a href="../pages/documentation.html">Documentation</a>.</p>
    <p>Old documentations you can find <a href="../pages/versions.html">here</a>.</p>
</div></section><section><div class="widget" id="searchbox" role="search">
    <h1><a href="#searchbox">Search</a></h1>
    <form action="../search.html" method="get">
        <input type="text" name="q" />
        <button type="submit"><span class="fa fa-search"></span></button>
    </form>
</div></section></aside></div> <!-- #main --></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo"><footer class="wrapper">&copy; Copyright 2015 - 2016, Yurii Shevchuk. Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.</footer>
    <a id="fork_me" href="http://github.com/itdxer/neupy">
        <img alt="Fork me" src="../_static/img/github-fork-green.png" />
    </a></div> <!-- footer-container -->

      </div> <!--! end of #container --><script type="text/javascript">    var disqus_shortname = "neupy";    disqus_count();</script><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>